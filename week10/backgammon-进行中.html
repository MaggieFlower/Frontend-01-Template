<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<style>
  body {
    margin: 0
  }

  table {
    width: 600px;
    height: 600px;
    background-color: rgb(99, 65, 65);
    border-collapse: collapse;
    margin-left: 50px;
    margin-top: 50px;
  }

  table tbody td {
    width: 50px;
    height: 50px;
    outline: 1px solid black
  }

  .cell {
    width: 40px;
    height: 40px;
    background-size: contain;
    display: inline-block;
    position: absolute
  }
</style>

<body>
  <table class="backgammon" cellspacing="0" cellpadding="0">
    <tbody>
    </tbody>
  </table>
</body>
<script>
  let gammon = document.querySelector('.backgammon').children[0]
  let children = gammon.children
  let gammonRecord = {
    0: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    1: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    3: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    4: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    5: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    6: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    7: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    8: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    9: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    10: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    11: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    12: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  }
  let blackList = []
  let whiteList = []
  // 1黑2白
  let color = 1
  let ft = document.createDocumentFragment()
  // 建棋盘
  let tr = document.createElement('tr')
  for (let i = 0; i < 12; i++) {
    tr.appendChild(document.createElement('td'))
  }
  for (let i = 0; i < 12; i++) {
    tr = tr.cloneNode(true)
    ft.appendChild(tr)
  }
  gammon.appendChild(ft)
  /*
  每排的坐标范围
{
    0: [50, 100],
    1: [100, 150],
    2: [150, 200],
    3: [200, 250],
    4: [250, 300],
    5: [300, 350],
    6: [350, 400],
    7: [400, 450],
    8: [450, 500],
    9: [500, 550],
    10: [550, 600],
    11: [600, 650]
  }
  每个交叉点的坐标
  {
    0: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    1: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    3: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    4: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    5: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    6: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    7: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    8: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    9: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    10: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    11: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    12: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  }

  左边点之间的关系
    (y, x)
    (6,6); (5, 5); (4,4); (3,3); (2,2) 左上
    (6,6); (7,5); (8,4); (9,3); (10,2) 左下
    (6,6); (5,7); (4,8); (3, 9); (2, 10)
    (6, 6); (7, 7); (8,8);(9,9);(10, 10)
    (6,6); (5,6);(4, 6); (3,6); (2,6)
    (6,6); (7,6); (8,6); (9, 6);(10,6)
    (6,6); (6,5);(6,4);(6,3);(6,2)
    (6,6); (6,7);(6,8);(6,9);(6,10)
    左边到达5个: 4<=x
    右边到达5个: x<=8
    上边到达5个: 4<=y
    下边到达5个: y<=8
    右下边到达5个: x<=8;y<=8
    右上边到达5个: x<=8;4<=y
    左上边到达5个: 4<=x; 4<=y
    左下边到达5个: 4<=x; y<=8
    左上: (5,4), (4,3), (3,2), (2,1),(1,0)
      (x, y), (x-1, y-1), (x-2, y-2),(x-3, y-3),(x-4, y-4)

    左下: (5,4), (4,5), (3,6), (2,7),(1,8)
      (x, y), (x-1, y+1), (x-2, y+2),(x-3, y+3),(x-4, y+4)

    右上: (5,4), (6, 3), (7,2), (8,1), (9,0)
      (x, y), (x+1, y-1), (x+2, y-2),(x+3, y-3),(x+4, y-4)

    右下: (5,4), (6, 5), (7,6), (8,7), (9,8)
      (x, y), (x+1, y+1), (x+2, y+2),(x+3, y+3),(x+4, y+4)

    上: (5,4), (5, 3), (5,2), (5,1), (5,0)
      (x, y), (x, y-1), (x, y-2),(x, y-3),(x, y-4)

    下: (5,4), (5, 5), (5,6), (5,7), (5,8)
      (x, y), (x, y+1), (x, y+2),(x, y+3),(x, y+4)

    左: (5,4), (4, 4), (3,4), (2,4), (1,4)
      (x, y), (x-1, y), (x-2, y),(x-3, y),(x-4, y)

    右 (5,4), (6, 4), (7,4), (8,4), (9,4)
      (x, y), (x+1, y), (x+2, y),(x+3, y),(x+4, y)
  */
  let allX = {
    0: [50, 100],
    1: [100, 150],
    2: [150, 200],
    3: [200, 250],
    4: [250, 300],
    5: [300, 350],
    6: [350, 400],
    7: [400, 450],
    8: [450, 500],
    9: [500, 550],
    10: [550, 600],
    11: [600, 650]
  }
  let allY = {
    0: [50, 100],
    1: [100, 150],
    2: [150, 200],
    3: [200, 250],
    4: [250, 300],
    5: [300, 350],
    6: [350, 400],
    7: [400, 450],
    8: [450, 500],
    9: [500, 550],
    10: [550, 600],
    11: [600, 650]
  }

  function willWin(pattern, color, x, y) {}

  function check(pattern, color, x, y) {
    // 横着的
    {
      let line = pattern[y]
      // 左边3个
      if ((line[x - 1] == line[x]) && (line[x - 2] == line[x]) && (line[x - 3] == line[x]) && (line[x - 4] == line[
          x]) && (color == line[x])) {
        return true
        // 左边2个
      } else if ((line[x - 1] == line[x]) && (line[x - 2] == line[x]) && (line[x + 2] == line[x]) && (line[x + 1] ==
          line[x]) && (color == line[x])) {
        return true
        // 左边1个
      } else if ((line[x - 1] == line[x]) && (line[x + 2] == line[x]) && (line[x + 3] == line[x]) && (line[x + 1] ==
          line[x]) && (color == line[x])) {
        return true
        // 左边 0个
      } else if ((line[x + 4] == line[x]) && (line[x + 2] == line[x]) && (line[x + 3] == line[x]) && (line[x + 1] ==
          line[x]) && (color == line[x])) {
        return true
      }
    }
    // 竖着的
    {
      let point = pattern[y][x]
      let y1top = pattern[y - 1][x],
        y2top = pattern[y - 2][x],
        y3top = pattern[y - 3][x],
        y4top = pattern[y - 4][x],
        y1bottom = pattern[y + 1][x],
        y2bottom = pattern[y + 2][x],
        y3bottom = pattern[y + 3][x],
        y4bottom = pattern[y + 4][x]
      // 上边4个
      if (y1top == point && y2top == point && y3top == point && y4top == point && point == color) {
        return true
        // 上边3个
      } else if (y1top == point && y2top == point && y3top == point && y1bottom == point && point == color) {
        return true
        // 上边2个
      } else if (y1top == point && y2top == point && y2bottom == point && y1bottom == point && point == color) {
        return true
        // 上边1个
      } else if (y1top == point && y3bottom == point && y2bottom == point && y1bottom == point && point == color) {
        return true
        // 上边0个
      } else if (y4bottom == point && y3bottom == point && y2bottom == point && y1bottom == point && point == color) {
        return true
      }
    }
    // \着的
    {
      let point = pattern[y][x]
      let leftTop1 = pattern[y - 1][x - 1],
        leftTop2 = pattern[y - 2][x - 2],
        leftTop3 = pattern[y - 3][x - 3],
        leftTop4 = pattern[y - 4][x - 4],
        rightbottom1 = pattern[y + 1][x + 1],
        rightbottom2 = pattern[y + 2][x + 2],
        rightbottom3 = pattern[y + 3][x + 3],
        rightbottom4 = pattern[y + 4][x + 4]
      // 左上4个
      if (leftTop1 == point && leftTop2 == point && leftTop3 == point && leftTop4 == point && point == color) {
        return true
        // 左上3个
      } else if (leftTop1 == point && leftTop2 == point && leftTop3 == point && rightbottom1 == point && point ==
        color) {
        return true
        // 左上2个
      } else if (leftTop1 == point && leftTop2 == point && rightbottom2 == point && rightbottom1 == point && point ==
        color) {
        return true
        // 左上1个
      } else if (leftTop1 == point && rightbottom3 == point && rightbottom2 == point && rightbottom1 == point &&
        point == color) {
        return true
        // 左上0个
      } else if (rightbottom4 == point && rightbottom3 == point && rightbottom2 == point && rightbottom1 == point &&
        point == color) {
        return true
      }
    }
    // /着的
    {
      let point = pattern[y][x]
      let leftbottom1 = pattern[y + 1][x - 1],
        leftbottom2 = pattern[y + 2][x - 2],
        leftbottom3 = pattern[y + 3][x - 3],
        leftbottom4 = pattern[y + 4][x - 4],
        righttop1 = pattern[y - 1][x + 1],
        righttop2 = pattern[y - 2][x + 2],
        righttop3 = pattern[y - 3][x + 3],
        righttop4 = pattern[y - 4][x + 4]

      // 左下4个
      if (leftbottom1 == point && leftbottom2 == point && leftbottom3 == point && leftbottom4 == point && point ==
        color) {
        return true
        // 左下3个
      } else if (leftbottom1 == point && leftbottom2 == point && leftbottom3 == point && righttop1 == point && point ==
        color) {
        return true
        // 左下2个
      } else if (leftbottom1 == point && leftbottom2 == point && righttop2 == point && righttop1 == point && point ==
        color) {
        return true
        // 左下1个
      } else if (leftbottom1 == point && righttop3 == point && righttop2 == point && righttop1 == point && point ==
        color) {
        return true
        // 左下0个
      } else if (righttop4 == point && righttop3 == point && righttop2 == point && righttop1 == point && point ==
        color) {
        return true
      }
    }
    return false
  }
  gammon.addEventListener('click', (event) => {
    // allX
    for (var x = 0; x < 12; x++) {
      if (allX[x][0] <= event.x && event.x < allX[x][1]) break
    }
    for (var y = 0; y < 12; y++) {
      if (allX[y][0] <= event.y && event.y < allX[y][1]) break
    }
    // 确定点落在哪里, 方形表示的范围
    let squareMaxX = (x + 1) * 50 + 50
    let squareMaxY = (y + 1) * 50 + 50
    let squareMinX = squareMaxX - 50
    let squareMinY = squareMaxY - 50
    let halfSquareX = squareMaxX - 25
    let halfSquareY = squareMaxY - 25
    let position
    // 左右上下的坐标范围
    let range = {
      'topLeft': [squareMinX, halfSquareX, squareMinY, halfSquareY],
      'topRight': [halfSquareX, squareMaxX, squareMinY, halfSquareY],
      'bottomLeft': [squareMinX, halfSquareX, halfSquareY, squareMaxY],
      'bottomRight': [halfSquareX, squareMaxX, halfSquareY, squareMaxY]
    }
    for (let r in range) {
      if (event.x >= range[r][0] && event.x < range[r][1] && event.y >= range[r][2] && event.y < range[r][3]) {
        position = r
        break
      }
    }
    let el = children[y].children[x]
    let gammonEl = document.createElement('div')
    gammonEl.setAttribute('class', 'cell')
    if (position == 'topLeft') {
      gammonEl.style.cssText =
        `top: ${squareMinY - 20}px;left: ${squareMinX - 20}px;background-image: url(${color==1?'./black.png': './white.png'})`
      el.appendChild(gammonEl)
      gammonRecord[y][x] = color
      if (check(gammonRecord, color, x, y)) {
        console.log(`${color==1?'黑棋胜!':'白棋胜!'}`)
      }
    } else if (position == 'topRight') {
      gammonEl.style.cssText =
        `top: ${squareMinY - 20}px;left: ${squareMaxX - 20}px;background-image: url(${color==1?'./black.png': './white.png'}`
      el.appendChild(gammonEl)
      gammonRecord[y][x + 1] = color
      if (check(gammonRecord, color, x + 1, y)) {
        console.log(`${color==1?'黑棋胜!':'白棋胜!'}`)
      }
    } else if (position == 'bottomLeft') {
      gammonEl.style.cssText =
        `top: ${squareMaxY - 20}px;left: ${squareMinX - 20}px;background-image: url(${color==1?'./black.png': './white.png'}`
      el.appendChild(gammonEl)
      gammonRecord[y + 1][x] = color
      if (check(gammonRecord, color, x, y + 1)) {
        console.log(`${color==1?'黑棋胜!':'白棋胜!'}`)
      }
    } else if (position == 'bottomRight') {
      gammonEl.style.cssText =
        `top: ${squareMaxY - 20}px;left: ${squareMaxX - 20}px;background-image: url(${color==1?'./black.png': './white.png'}`
      el.appendChild(gammonEl)
      gammonRecord[y + 1][x + 1] = color
      if (check(gammonRecord, color, x + 1, y + 1)) {
        console.log(`${color==1?'黑棋胜!':'白棋胜!'}`)
      }
    }
    color = 3 - color
  })
</script>

</html>